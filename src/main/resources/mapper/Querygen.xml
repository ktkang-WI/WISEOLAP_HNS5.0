<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wise.MarketingPlatForm.querygen.dao.QuerygenDAO">
    <select id="selectCubeRelation" parameterType="int" resultType="com.wise.MarketingPlatForm.querygen.dto.Relation">
        SELECT	A.DS_ID AS DS_ID

               ,B.DS_VIEW_ID AS DS_VIEW_ID

               ,C.CUBE_ID AS CUBE_ID

               ,D.CONST_NM as CONST_NM

               ,D.FK_TBL_NM as FK_TBL_NM

               ,D.FK_COL_NM as FK_COL_NM

               ,D.PK_TBL_NM  as PK_TBL_NM

               ,D.PK_COL_NM as PK_COL_NM

               ,D.JOIN_TYPE as JOIN_TYPE

               ,D.JOIN_SET_OWNER as JOIN_SET_OWNER

               ,D.REL_CONST_NM as REL_CONST_NM

               ,D.DIM_UNI_NM as DIM_UNI_NM

               ,D.MEA_GRP_UNI_NM as MEA_GRP_UNI_NM

               ,'' AS MODIFY_TAG
               
               ,E.COL_EXPRESS AS FK_EXPRESS
               
               ,F.COL_EXPRESS AS PK_EXPRESS
          FROM	  DS_MSTR A

                INNER JOIN DS_VIEW_MSTR B ON A.DS_ID = B.DS_ID 

                INNER JOIN CUBE_MSTR C ON B.DS_VIEW_ID = C.DS_VIEW_ID 

                INNER JOIN CUBE_REL_MSTR D ON C.CUBE_ID = D.CUBE_ID
                
                INNER JOIN DS_VIEW_COL_MSTR E
                	ON B.DS_VIEW_ID = E.DS_VIEW_ID
                	AND D.FK_COL_NM = E.COL_NM
                	AND D.FK_TBL_NM = E.TBL_NM
                
                INNER JOIN DS_VIEW_COL_MSTR F
                	ON B.DS_VIEW_ID = F.DS_VIEW_ID
                	AND D.PK_COL_NM = F.COL_NM
                	AND D.PK_TBL_NM = F.TBL_NM

   		  WHERE	  1 = 1
   		  AND C.CUBE_ID = #{cubeId}
    </select>
</mapper>