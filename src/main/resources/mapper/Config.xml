<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wise.MarketingPlatForm.config.dao.ConfigDAO">
    
    <resultMap id="FldMstr" type="com.wise.MarketingPlatForm.config.entity.FldMstrEntity">
      <result column="FLD_ID" property="fldId" javaType="int"/>
      <result column="FLD_NM" property="fldNm" javaType="String"/>
      <result column="FLD_LVL" property="fldLvl" javaType="int"/>
      <result column="FLD_PARENT_ID" property="fldParentId" javaType="int"/>
      <result column="FLD_ORDINAL" property="fldOrdinal" javaType="int"/>
      <result column="FLD_DESC" property="fldDesc" javaType="String"/>
    </resultMap>

    <resultMap id="ConfigFolderReportDTO" type="com.wise.MarketingPlatForm.config.dto.folder.ConfigFolderReportDTO">
      <result column="FLD_ID" property="fldId" javaType="int"/>
      <result column="FLD_NM" property="fldNm" javaType="String"/>
      <result column="FLD_LVL" property="fldLvl" javaType="int"/>
      <result column="FLD_PARENT_ID" property="fldParentId" javaType="int"/>
      <result column="FLD_ORDINAL" property="fldOrdinal" javaType="int"/>
      <result column="REPORT_ID" property="reportId" javaType="int"/>
      <result column="REPORT_NM" property="reportNm" javaType="String"/>
      <result column="REPORT_SUB_TITLE" property="reportSubTitle" javaType="String"/>
      <result column="USER_ID" property="userId" javaType="String"/>
      <result column="REG_DT" property="regDt" javaType="String"/>
      <result column="REPORT_TAG" property="reportTag" javaType="String"/>
      <result column="REPORT_ORDINAL" property="reportOrdinal" javaType="String"/>
      <result column="REPORT_DESC" property="reportDesc" javaType="String"/>
      <result column="REPORT_TYPE" property="reportType" javaType="String"/>
    </resultMap>

    <resultMap id="ConfigGeneralDTO" type="com.wise.MarketingPlatForm.config.dto.GeneralDTO">
      <result column="MAIN_TITLE" property="mainTitle" javaType="String"/>
      <result column="LICENSES_KEY" property="licensesKey" javaType="String"/>
      <result column="WEB_URL" property="webUrl" javaType="String"/>
      <result column="LOGIN_IMAGE" property="loginImage" javaType="String"/>
      <result column="LOGO" property="logo" javaType="String"/>
      <result column="SPREAD_JS_LICENSE" property="spreadJsLicense" javaType="String"/>
      <result column="SPREAD_JS_DESIGNER_LICENSE" property="spreadJsDesignLicense" javaType="String"/>
      <result column="KAKAO_MAP_API_KEY" property="kakaoMapApiKey" javaType="String"/>
      <result column="MENU_CONFIG" property="menuConfig" javaType="String"/>
    </resultMap>

    <resultMap id="ConfigFolderDatasetDTO" type="com.wise.MarketingPlatForm.config.dto.folder.ConfigFolderDatasetDTO">
      <result column="FLD_ID" property="fldId" javaType="int"/>
      <result column="FLD_NM" property="fldNm" javaType="String"/>
      <result column="PARENT_FLD_ID" property="parentFldId" javaType="int"/>
      <result column="FLD_ORDINAL" property="fldOridinal" javaType="int"/>
    </resultMap>

    <resultMap id="ConfigFolderDTO" type="com.wise.MarketingPlatForm.config.dto.folder.ConfigFolderDTO">
      <result column="GRP_ID" property="grpId" javaType="int"/>
      <result column="FLD_ID" property="fldId" javaType="int"/>
      <result column="FLD_NM" property="fldNm" javaType="String"/>
      <result column="FLD_LVL" property="fldLvl" javaType="int"/>
      <result column="FLD_PARENT_ID" property="fldParentId" javaType="int"/>
      <result column="FLD_ORDINAL" property="fldOridinal" javaType="int"/>
      <result column="AUTH_VIEW" property="authView" javaType="String"/>
      <result column="AUTH_PUBLISH" property="authPublish" javaType="String"/>
      <result column="AUTH_DATAITEM" property="authDataItem" javaType="String"/>
      <result column="AUTH_EXPORT" property="authExport" javaType="String"/>
    </resultMap>

    <select id="selectConfigFolder" resultMap="FldMstr">
			SELECT
        FLD_ID,
        FLD_NM,
        FLD_LVL,
        FLD_PARENT_ID,
        FLD_ORDINAL,
        FLD_DESC
        FROM PUB_FLD_MSTR
            ORDER BY FLD_LVL ASC, FLD_ORDINAL ASC
		</select>

		<select id="selectGeneralData" resultMap="ConfigGeneralDTO">
			SELECT
        CONFIG_MSTR.MAIN_TITLE,
        CONFIG_MSTR.LICENSES_KEY,
        CONFIG_MSTR.WEB_URL,
        WB_CONFIG_MSTR.LOGIN_IMAGE,
        WB_CONFIG_MSTR.LOGO,
        WB_CONFIG_MSTR.SPREAD_JS_LICENSE,
        WB_CONFIG_MSTR.SPREAD_JS_DESIGNER_LICENSE,
        WB_CONFIG_MSTR.KAKAO_MAP_API_KEY,
        WB_CONFIG_MSTR.MENU_CONFIG
        FROM CONFIG_MSTR INNER JOIN WB_CONFIG_MSTR ON 1 = 1
		</select>

    <select id="selectConfigFolderDataset" resultMap="ConfigFolderDatasetDTO">
			SELECT
        FLD_ID,
        FLD_NM,
        PARENT_FLD_ID,
        FLD_ORDINAL
        FROM DATASET_FLD_MSTR
        ORDER BY
            FLD_ID,
            FLD_ORDINAL
		</select>

    <select id="selectConfigFolderReport" resultMap="ConfigFolderReportDTO">
			SELECT
        PUB_FLD_MSTR.FLD_ID,
        PUB_FLD_MSTR.FLD_NM,
        PUB_FLD_MSTR.FLD_LVL,
        PUB_FLD_MSTR.FLD_PARENT_ID,
        PUB_FLD_MSTR.FLD_ORDINAL,
        REPORT_MSTR.REPORT_ID,
        REPORT_MSTR.REPORT_NM,
        REPORT_MSTR.REPORT_SUB_TITLE,
        USER_MSTR.USER_ID,
        REPORT_MSTR.REG_DT,
        REPORT_MSTR.REPORT_TAG,
        REPORT_MSTR.REPORT_ORDINAL,
        REPORT_MSTR.REPORT_DESC,
        REPORT_MSTR.REPORT_TYPE
        FROM PUB_FLD_MSTR INNER JOIN REPORT_MSTR
            ON PUB_FLD_MSTR.FLD_ID = REPORT_MSTR.FLD_ID
                          INNER JOIN USER_MSTR 
            ON USER_MSTR.USER_NO = REPORT_MSTR.REG_USER_NO
            WHERE REPORT_MSTR.DEL_YN = 'N' AND USER_MSTR.DEL_YN = 'N'
            ORDER BY 3 ASC, 5 ASC
		</select>
    
    <select id="selectConfigFolderGroup" resultMap="ConfigFolderDTO">
			SELECT
        GRP_AUTH_REPORT_MSTR.GRP_ID,
        PUB_FLD_MSTR.FLD_ID,
        PUB_FLD_MSTR.FLD_NM,
        PUB_FLD_MSTR.FLD_LVL,
        PUB_FLD_MSTR.FLD_PARENT_ID,
        PUB_FLD_MSTR.FLD_ORDINAL,
        GRP_AUTH_REPORT_MSTR.AUTH_VIEW,
        GRP_AUTH_REPORT_MSTR.AUTH_PUBLISH,
        GRP_AUTH_REPORT_MSTR.AUTH_DATAITEM,
        GRP_AUTH_REPORT_MSTR.AUTH_EXPORT
        FROM PUB_FLD_MSTR INNER JOIN GRP_AUTH_REPORT_MSTR
        ON PUB_FLD_MSTR.FLD_ID = GRP_AUTH_REPORT_MSTR.FLD_ID
        ORDER BY 
            GRP_AUTH_REPORT_MSTR.GRP_ID,
            PUB_FLD_MSTR.FLD_ID DESC, 
            PUB_FLD_MSTR.FLD_LVL ASC, 
            PUB_FLD_MSTR.FLD_ORDINAL ASC
		</select>

    <update id="updateConfig" parameterType="com.wise.MarketingPlatForm.config.entity.ConfigMstrEntity">
      UPDATE CONFIG_MSTR
          SET 
              <if test='mainTitle != ""'>
                MAIN_TITLE = #{mainTitle, jdbcType=VARCHAR},
              </if>
              <if test='licensesKey != ""'>
                LICENSES_KEY = #{licensesKey, jdbcType=VARCHAR},
              </if>
              <if test='webUrl != ""'>
                WEB_URL = #{webUrl, jdbcType=VARCHAR},
              </if>
              MAIN_TAB_EX = MAIN_TAB_EX
          WHERE 1 = 1
    </update>

    <update id="updateWbConfig" parameterType="com.wise.MarketingPlatForm.config.entity.WbConfigMstrEntity">
        UPDATE WB_CONFIG_MSTR
          SET 
              <if test='loginImage != ""'>
                LOGIN_IMAGE = #{loginImage, jdbcType=VARCHAR},
              </if>
              <if test='logo != ""'>
                LOGO = #{logo, jdbcType=VARCHAR},
              </if>
              <if test='spreadJsLicense != ""'>
                SPREAD_JS_LICENSE = #{spreadJsLicense, jdbcType=VARCHAR},
              </if>
              <if test='spreadJsDesignLicense != ""'>
                SPREAD_JS_DESIGNER_LICENSE = #{spreadJsDesignLicense, jdbcType=VARCHAR},
              </if>
              <if test='kakaoMapApiKey != ""'>
                KAKAO_MAP_API_KEY = #{kakaoMapApiKey, jdbcType=VARCHAR},
              </if>
              <if test='menuConfig != ""'>
                MENU_CONFIG = #{menuConfig, jdbcType=VARCHAR},
              </if>
              REPORT_DIRECT_VIEW = REPORT_DIRECT_VIEW
          WHERE 1 = 1
    </update>
  
    <update id="updateConfigFolder" parameterType="com.wise.MarketingPlatForm.config.entity.FldMstrEntity">
        UPDATE PUB_FLD_MSTR
          SET 
              <if test='fldLvl != 0'>
                FLD_LVL = #{fldLvl, jdbcType=INTEGER},
              </if>
              <if test='fldParentId != 0'>
                FLD_PARENT_ID = #{fldParentId, jdbcType=INTEGER},
              </if>
              <if test='fldOrdinal != 0'>
                FLD_ORDINAL = #{fldOrdinal, jdbcType=INTEGER},
              </if>
              <if test='fldDesc != ""'>
                FLD_DESC = #{fldDesc, jdbcType=VARCHAR},
              </if>
              <if test='fldNm != ""'>
                FLD_NM = #{fldNm, jdbcType=VARCHAR},
              </if>
              FLD_ID = FLD_ID
          WHERE FLD_ID = #{fldId, jdbcType=INTEGER}
    </update>

    <insert id="createConfigFolder" parameterType="com.wise.MarketingPlatForm.config.entity.FldMstrEntity">
        INSERT INTO
        PUB_FLD_MSTR(
            FLD_ID,
            FLD_NM,
            FLD_LVL,
            FLD_PARENT_ID,
            FLD_ORDINAL,
            FLD_DESC
        )
        VALUES(
            PUB_FLD_MSTR_FLD_ID_SEQ.NEXTVAL,
            #{fldNm, jdbcType=VARCHAR},
            #{fldLvl, jdbcType=INTEGER},
            #{fldParentId, jdbcType=INTEGER},
            #{fldOrdinal, jdbcType=INTEGER},
            #{fldDesc, jdbcType=VARCHAR}
        )
    </insert>

    <delete id="deleteConfigFolder" parameterType="com.wise.MarketingPlatForm.config.entity.FldMstrEntity">
      DELETE FROM PUB_FLD_MSTR 
              WHERE FLD_ID = #{fldId, jdbcType=INTEGER}
    </delete>

</mapper>